"use strict";angular.module("cgeUploaderApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngFileUpload","ui.bootstrap","ui.grid","ui.grid.resizeColumns","ui.grid.autoResize","cgeUploaderApp.config"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/kmerfinder.html",controller:"KmerFinderCtrl",controllerAs:"kmerfinder"}).otherwise({redirectTo:"/"})}]),angular.module("cgeUploaderApp").controller("KmerFinderCtrl",["$scope","API","$q",function(a,b,c){console.log(b),a.isolateFilesPromises=[],a.matches=!1,a.error=!1,a.message={text:"",status:0},a.$on("startParsing",function(b,c){var d=-1,e=function(){return console.log(d,c.length-1,c),d>=c.length-1?void 0:(d++,a.parseFile(c[d]).then(e)["catch"](function(b){console.log("ERROR!!",b),a.message.text=b,a.message.status=2,a.$apply()}))};e()}),a.parseFile=function(c){console.log(c);var d=new kmerModule.KmerFinderClient(c,"browser","ATGAC",16,1,1,!0,"server",b.url+"kmers","","KmerBacteria","Kmers");a.fileProgress=d.lines;var e=d.findKmers();return e.event.on("progress",function(b){c.kmerSize=d.kmerMap.size,c.dataRead=100*b.transferred/c.size,a.$apply()}),e.promise.then(function(a){return console.log("Assigning kmers!"),c.kmers=a,console.log("Let's find some matches! "),d.findFirstMatch(a)}).then(function(b){function e(d){(b=d.next()).done||(c.matchesGrid.data.push(b.value),a.$apply(),setTimeout(function(){e(d)},10))}console.log("Winner found!"),c.species=b.species,c.match=!0,d.progress=!1;var f=d.findMatches(b,c.kmers);e(f)})}}]),angular.module("cgeUploaderApp").directive("dropFilesButton",function(){return{templateUrl:"templates/dropFilesButton.html",restrict:"E",link:function(a,b,c){console.log(a,b,c,a.isolateFiles),a.tabs=a.$parent.tabs,a.filesValid=!1,a.isService=c.isService,a.parsedFiles=0,a.dropping=function(b){0!==b.length&&(console.log("Start parsing"),a.$broadcast("startParsing",b))},a.validate=function(a){return a.match=!1,a.species="",a.firstTime=a.firstTime?!1:!0,a.matchesGrid={showGridFooter:!0,enableSorting:!0,cellEditableCondition:!0,onRegisterApi:function(b){console.log(b),a.gridApi=b},columnDefs:[{field:"species",width:"50%"},{field:"template",width:"20%"},{field:"score",width:"10%"},{field:"expected",width:"10%"},{field:"z",width:"10%"},{field:"probability",width:"10%"},{field:"frac-q",width:"12%"},{field:"frac-d",width:"12%"},{field:"depth",width:"10%"},{field:"kmers-template",width:"10%"},{field:"total-frac-d",width:"10%"},{field:"total-frac-q",width:"10%"},{field:"total-temp-cover",width:"10%"}],data:[]},a.status={isFirstOpen:!0,isFirstDisabled:!1},!0}}}}),angular.module("cgeUploaderApp").run(["$templateCache",function(a){a.put("views/kmerfinder.html",'<div ng-controller="KmerFinderCtrl"> <div class="jumbotron"> <h1 class="text-center"> <span style="color: #3f51b5">KmerFinder</span> <span style="color: #ff5722">JS</span> </h1> <!-- <p>...</p>\n        <p><a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a></p> --> </div> <drop-files-button active="true" is-service="true"></drop-files-button> <div ng-show="isolateFiles.length !== 0" class="well well-lg"> <div class="row"> <div class="col-xs-6"> <!-- <button id="submitButton" ng-click="analize()" type="button" class="text-center btn btn-material-indigo-500 btn-lg">\n                    Predict Species\n                </button> --> </div> <div class="col-xs-6"> <p ng-show="message.status !== 0" class="text-center" ng-class="{\n                      \'alert alert-danger\': message.status === 2,\n                      \'alert alert-info\': message.status === 1,\n                      \'alert alert-success\': message.status === 3}"> {{message.text}} </p> </div> </div> <div ng-repeat="f in isolateFiles"> <div class="text-center" ng-show="f.dataRead"> Reading <strong ng-class="{parsing: f.dataRead < 100, parsed: f.dataRead >= 100}"> {{f.name}} </strong> <div>({{f.kmerSize}} kmers)</div> <div class="progress"> <div class="progress-bar" style="width: {{f.dataRead}}%"></div> <span class="sr-only">{{f.dataRead}}%</span> </div> </div> <h3 ng-show="f.match" class="text-center"> <span style="color: #ff5722">{{f.species}}</span> </h3> <div ng-show="f.match" ui-grid="f.matchesGrid" class="myGrid" ui-grid-auto-resize ui-grid-resize-columns></div> </div> </div> </div>')}]);